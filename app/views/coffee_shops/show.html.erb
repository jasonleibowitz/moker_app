<!-- <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' /> -->

<script href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.js'></script>
<link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.2/mapbox.css' rel='stylesheet' />

<div class="row">
  <div class="big-space"></div>
</div>

<div class="row">
  <div class="small-8 small-centered columns detail-wrap">
    <div class="small-8 columns">
      <h1 class="title"><%= @coffee_shop.name %></h1>
    </div>
    <div class="row">
      <div class="small-4 columns">
        <div class="circle">
          <p class="circle-rating"><%= @coffee_shop.rating %></p>
        </div>
      </div>
    </div>
    <div class="small-6 columns ratings">
      <p><span title="Coffee Quality Rating"><i class="fa fa-coffee"></i> - <%= (@coffee_shop.coffee_rating * 10).to_i %></span> &nbsp;
         <span title="WiFi Signal Quality Rating"><i class="fa fa-signal"></i> - <%= (@coffee_shop.wifi_rating * 10).to_i %></span> &nbsp;
         <span title="Workspace Availability Rating"><i class="fa fa-desktop"></i> - <%= (@coffee_shop.workspace_rating * 10).to_i %></span> &nbsp;
         <span title="Power Outlet Availability Rating"><i class="fa fa-power-off"> </i> - <%= (@coffee_shop.outlet_rating * 10).to_i %></span></p>
    </div>
    <div class="row">
      <div class="small-4 small-offset-1 columns rate-button">
        <a href="#" data-reveal-id='new-survey' data-reveal-ajax="<%= new_coffee_shop_reviews_path(@coffee_shop) %>" class="button tiny radius">Quick survey</a>
      </div>
    </div>
    <div class="row">
      <div class="small-8 small-centered columns tips">
        <div class="small-6 columns">
          <h6 class="tip-title">Tips:</h6>
        </div>
        <div class="small-4 small-offset-2 columns tip-button">
          <a href="#" data-reveal-id='new-tip' data-reveal-ajax="<%= new_coffee_shop_tip_path(@coffee_shop) %>" class="button tiny radius">Leave a Tip</a>
          <div id="new-tip" class="reveal-modal medium" data-reveal>
            <h3>Leave a Tip!</h3>
            <a class="close-reveal-modal">&#215;</a>
          </div>
        </div>
        <hr>
        <% @coffee_shop.tips.order(created_at: :desc).each do |tip| %>
        <p class="tip-comment"><%= tip.comment %></p>
        <div class="small-2 columns">
          <div class="review-avatar-wrap"><img class="review-avatar" src="<%= tip.user.image %>"></div>
        </div>
        <div class="small-7 columns">
          <p class="tip-username"><%= tip.user.name %> | <%= tip.created_at.strftime "%B %e, %Y" %></p>
        </div>
        <hr>
        <% end %>


        <% @coffee_shop.foursquare_reviews.each do |foursquare_review| %>
        <p class="tip-comment"><%= foursquare_review.comment %></p>
        <div class="small-2 columns">
          <div class="review-avatar-wrap"><img class="review-avatar" src="<%= foursquare_review.user_pic %>"></div>
        </div>
        <div class="small-7 columns">
          <p class="tip-username"><%= foursquare_review.username %> | <%= foursquare_review.created_at.strftime "%B %e, %Y" %></p>
        </div>
        <hr>
        <% end %>
      </div>
    </div>
    <div class="row">
      <div class="small-8 small-centered columns">
        <style> #map { position:relative; top:25px; bottom:0; width:100%; height:400px; } </style>
        <div id="map" lon-coordinate='<%= @coffee_shop.lon %>' lat-coordinate="<%= @coffee_shop.lat %>" shop-name="<%= @coffee_shop.name %>" shop-address='<%= @coffee_shop.address %>'></div>

        <script>
          var map = L.mapbox.map('map', 'jasonleibowitz.i7i19hk9')
            .setView([<%= @coffee_shop.lat %>, <%= @coffee_shop.lon %>], 15);

              L.mapbox.featureLayer({
              // this feature is in the GeoJSON format: see geojson.org
              // for the full specification
              type: 'Feature',
              geometry: {
                  type: 'Point',
                  // coordinates here are in longitude, latitude order because
                  // x, y is the standard for GeoJSON and many formats
                  coordinates: [<%= @coffee_shop.lon %>, <%= @coffee_shop.lat %>]
              },
              properties: {
                  title: '<%= @coffee_shop.name %>',
                  description: '<%= @coffee_shop.address %>',
                  // one can customize markers by adding simplestyle properties
                  // http://mapbox.com/developers/simplestyle/
                  'marker-size': 'large',
                  'marker-color': '#008CBA',
                  'marker-symbol': 'cafe'
              }
          }).addTo(map);
        </script>

      </div>
    </div>
    <div class="row">
      <div class="big-space"></div>
    </div>
  </div>
</div>
